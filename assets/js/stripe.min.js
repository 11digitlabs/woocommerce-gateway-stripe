Stripe.setPublishableKey(wc_stripe_params.key),jQuery(function(e){"use strict";e("form.checkout, form#order_review").on("change",'input[name="wc-stripe-payment-token"]',function(){"new"===e('.stripe-legacy-payment-fields input[name="wc-stripe-payment-token"]:checked').val()?e(".stripe-legacy-payment-fields #stripe-payment-data").slideDown(200):e(".stripe-legacy-payment-fields #stripe-payment-data").slideUp(200)});var r={init:function(){e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_stripe",this.onSubmit),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form#add_payment_method").on("submit",this.onSubmit),e(document).on("change","#wc-stripe-cc-form :input",this.onCCFormChange).on("stripeError",this.onError).on("checkout_error",this.clearToken)},isStripeChosen:function(){return e("#payment_method_stripe").is(":checked")&&(!e('input[name="wc-stripe-payment-token"]:checked').length||"new"===e('input[name="wc-stripe-payment-token"]:checked').val())},hasToken:function(){return 0<e("input.stripe_token").length},block:function(){r.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){r.form.unblock()},onError:function(t,n){var i=n.response.error.message;"invalid_request_error"!==n.response.error.type&&"api_connection_error"!==n.response.error.type&&"api_error"!==n.response.error.type&&"authentication_error"!==n.response.error.type&&"rate_limit_error"!==n.response.error.type||(i=wc_stripe_params.invalid_request_error),"card_error"===n.response.error.type&&wc_stripe_params.hasOwnProperty(n.response.error.code)&&(i=wc_stripe_params[n.response.error.code]),e(".wc-stripe-error, .stripe_token").remove(),e("#stripe-card-number").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-stripe-error"><li>'+i+"</li></ul>"),r.unblock()},onSubmit:function(t){if(r.isStripeChosen()&&!r.hasToken()){t.preventDefault(),r.block();var n=e("#stripe-card-number").val(),i=e("#stripe-card-cvc").val(),s=e("#stripe-card-expiry").payment("cardExpiryVal"),o=e("#billing_first_name").length?e("#billing_first_name").val():wc_stripe_params.billing_first_name,a=e("#billing_last_name").length?e("#billing_last_name").val():wc_stripe_params.billing_last_name,p={number:n,cvc:i,exp_month:parseInt(s.month,10)||0,exp_year:parseInt(s.year,10)||0};return o&&a&&(p.name=o+" "+a),e("#billing_address_1").length>0?(p.address_line1=e("#billing_address_1").val(),p.address_line2=e("#billing_address_2").val(),p.address_state=e("#billing_state").val(),p.address_city=e("#billing_city").val(),p.address_zip=e("#billing_postcode").val(),p.address_country=e("#billing_country").val()):wc_stripe_params.billing_address_1&&(p.address_line1=wc_stripe_params.billing_address_1,p.address_line2=wc_stripe_params.billing_address_2,p.address_state=wc_stripe_params.billing_state,p.address_city=wc_stripe_params.billing_city,p.address_zip=wc_stripe_params.billing_postcode,p.address_country=wc_stripe_params.billing_country),Stripe.createToken(p,r.onStripeResponse),!1}},onCCFormChange:function(){e(".wc-stripe-error, .stripe_token").remove()},onStripeResponse:function(t,n){if(n.error)e(document).trigger("stripeError",{response:n});else{if("no"===wc_stripe_params.allow_prepaid_card&&"prepaid"===n.card.funding)return n.error={message:wc_stripe_params.no_prepaid_card_msg},e(document).trigger("stripeError",{response:n}),!1;var i=n.id;r.form.append("<input type='hidden' class='stripe_token' name='stripe_token' value='"+i+"'/>"),r.form.submit()}},clearToken:function(){e(".stripe_token").remove()}};r.init()});