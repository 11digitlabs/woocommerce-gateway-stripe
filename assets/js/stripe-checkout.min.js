jQuery(function(e){"use strict";var t={init:function(t){this.form=t,this.stripe_submit=!1,e(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_stripe"),e(document.body).on("checkout_error",this.resetModal)},isStripeChosen:function(){return e("#payment_method_stripe").is(":checked")&&(!e('input[name="wc-stripe-payment-token"]:checked').length||"new"===e('input[name="wc-stripe-payment-token"]:checked').val())},isStripeModalNeeded:function(i){var n,r=t.form.find("input.stripe_token");if(t.stripe_submit&&r)return!1;if(!t.isStripeChosen())return!1;if(1===e("input#terms").length&&0===e("input#terms:checked").length)return!1;if(e("#createaccount").is(":checked")&&e("#account_password").length&&""===e("#account_password").val())return!1;if((n=e(e("#ship-to-different-address-checkbox").is(":checked")?".woocommerce-billing-fields .validate-required, .woocommerce-shipping-fields .validate-required":".woocommerce-billing-fields .validate-required")).length){var a=!1;if(n.each(function(){""===e(this).find("input.input-text, select").not(e("#account_password, #account_username")).val()&&(a=!0);var t=e(this).find("#billing_email");t.length&&(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t.val())||(a=!0))}),a)return!1}return!0},block:function(){t.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t.form.unblock()},onClose:function(){t.unblock()},onSubmit:function(i){if(t.isStripeModalNeeded()){i.preventDefault();var n=t.form,r=e("#stripe-payment-data");n.find("input.stripe_token").val("");return StripeCheckout.open({key:wc_stripe_params.key,billingAddress:"yes"===wc_stripe_params.stripe_checkout_require_billing_address,amount:r.data("amount"),name:r.data("name"),description:r.data("description"),currency:r.data("currency"),image:r.data("image"),bitcoin:r.data("bitcoin"),locale:r.data("locale"),email:e("#billing_email").val()||r.data("email"),panelLabel:r.data("panel-label"),allowRememberMe:r.data("allow-remember-me"),token:function(e){n.find("input.stripe_token").remove(),n.append('<input type="hidden" class="stripe_token" name="stripe_token" value="'+e.id+'"/>'),t.stripe_submit=!0,n.submit()},closed:t.onClose()}),!1}return!0},resetModal:function(){t.form.find("input.stripe_token").remove(),t.stripe_submit=!1}};t.init(e("form.checkout, form#order_review, form#add_payment_method"))});