jQuery(function(e){"use strict";var t={getAjaxURL:function(e){return wc_stripe_params.ajaxurl.toString().replace("%%endpoint%%","wc_stripe_"+e)},init:function(t){this.form=t,this.stripe_submit=!1,e(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_stripe"),e(document.body).on("checkout_error",this.resetModal)},isStripeChosen:function(){return e("#payment_method_stripe").is(":checked")&&(!e('input[name="wc-stripe-payment-token"]:checked').length||"new"===e('input[name="wc-stripe-payment-token"]:checked').val())},isStripeModalNeeded:function(e){var o=t.form.find("input.stripe_token");return(!t.stripe_submit||!o)&&!!t.isStripeChosen()},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){t.isMobile()?e.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}}):t.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t.isMobile()?e.unblockUI():t.form.unblock()},onClose:function(){t.unblock()},onSubmit:function(e){return!t.isStripeModalNeeded()||(e.preventDefault(),t.isMobile()?t.openModal():t.validateCheckout(),!1)},openModal:function(){var o=t.form,i=e("#stripe-payment-data");o.find("input.stripe_token").val("");StripeCheckout.open({key:wc_stripe_params.key,billingAddress:"yes"===wc_stripe_params.stripe_checkout_require_billing_address,amount:i.data("amount"),name:i.data("name"),description:i.data("description"),currency:i.data("currency"),image:i.data("image"),bitcoin:i.data("bitcoin"),locale:i.data("locale"),email:e("#billing_email").val()||i.data("email"),panelLabel:i.data("panel-label"),allowRememberMe:i.data("allow-remember-me"),token:function(e){o.find("input.stripe_token").remove(),o.append('<input type="hidden" class="stripe_token" name="stripe_token" value="'+e.id+'"/>'),t.stripe_submit=!0,o.submit()},closed:t.onClose()})},resetModal:function(){t.form.find("input.stripe_token").remove(),t.stripe_submit=!1},getRequiredFields:function(){return t.form.find(".form-row.validate-required > input, .form-row.validate-required > select")},validateCheckout:function(){var o={nonce:wc_stripe_params.stripe_nonce,required_fields:t.getRequiredFields().serialize(),all_fields:t.form.serialize()};e.ajax({type:"POST",url:t.getAjaxURL("validate_checkout"),data:o,dataType:"json",success:function(e){"success"===e?t.openModal():e.messages&&(t.resetModal(),t.submitError(e.messages))}})},submitError:function(o){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),t.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+o+"</div>"),t.form.find(".input-text, select, input:checkbox").blur(),e("html, body").animate({scrollTop:e("form.checkout").offset().top-100},1e3),e(document.body).trigger("checkout_error")}};t.init(e("form.checkout, form#order_review, form#add_payment_method"))});