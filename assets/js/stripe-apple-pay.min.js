Stripe.setPublishableKey(wc_stripe_apple_pay_params.key),jQuery(function(e){"use strict";var p={getAjaxURL:function(e){return wc_stripe_apple_pay_params.ajaxurl.toString().replace("%%endpoint%%","wc_stripe_"+e)},init:function(){Stripe.applePay.checkAvailability(function(a){a&&(e(".apple-pay-button").show(),e(".woocommerce-checkout .apple-pay-button").css("visibility","visible"),e(".apple-pay-button-checkout-separator").show(),p.generate_cart())}),e(document.body).on("click",".apple-pay-button",function(a){a.preventDefault();var t={countryCode:wc_stripe_apple_pay_params.country_code,currencyCode:wc_stripe_apple_pay_params.currency_code,total:{label:wc_stripe_apple_pay_params.label,amount:wc_stripe_apple_pay_params.total},lineItems:wc_stripe_apple_pay_params.line_items,requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:"yes"===wc_stripe_apple_pay_params.needs_shipping?["postalAddress","phone","email","name"]:["phone","email","name"]},s=Stripe.applePay.buildSession(t,function(a,t){var s={nonce:wc_stripe_apple_pay_params.stripe_apple_pay_nonce,result:a};e.ajax({type:"POST",data:s,url:p.getAjaxURL("apple_pay"),success:function(p){"true"===p.success&&(t(ApplePaySession.STATUS_SUCCESS),window.location.href=p.redirect),"false"===p.success&&(t(ApplePaySession.STATUS_FAILURE),e(".apple-pay-button").before('<p class="woocommerce-error wc-stripe-apple-pay-error">'+p.msg+"</p>"),e(document.body).animate({scrollTop:e(".wc-stripe-apple-pay-error").offset().top},500))}})},function(a){var t={nonce:wc_stripe_apple_pay_params.stripe_apple_pay_cart_nonce,errors:a.message};e.ajax({type:"POST",data:t,url:p.getAjaxURL("log_apple_pay_errors")})});"yes"===wc_stripe_apple_pay_params.needs_shipping&&(s.onshippingcontactselected=function(a){var t={nonce:wc_stripe_apple_pay_params.stripe_apple_pay_get_shipping_methods_nonce,address:a.shippingContact};e.ajax({type:"POST",data:t,url:p.getAjaxURL("apple_pay_get_shipping_methods"),success:function(e){var p={label:wc_stripe_apple_pay_params.label,amount:e.total};"true"===e.success&&s.completeShippingContactSelection(ApplePaySession.STATUS_SUCCESS,e.shipping_methods,p,e.line_items),"false"===e.success&&s.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,e.shipping_methods,p,e.line_items)}})},s.onshippingmethodselected=function(a){var t={nonce:wc_stripe_apple_pay_params.stripe_apple_pay_update_shipping_method_nonce,selected_shipping_method:a.shippingMethod};e.ajax({type:"POST",data:t,url:p.getAjaxURL("apple_pay_update_shipping_method"),success:function(e){var p={label:wc_stripe_apple_pay_params.label,amount:parseFloat(e.total).toFixed(2)};"true"===e.success&&s.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS,p,e.line_items),"false"===e.success&&s.completeShippingMethodSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,p,e.line_items)}})}),s.begin()})},generate_cart:function(){var a={nonce:wc_stripe_apple_pay_params.stripe_apple_pay_cart_nonce};e.ajax({type:"POST",data:a,url:p.getAjaxURL("generate_apple_pay_cart"),success:function(e){wc_stripe_apple_pay_params.total=e.total,wc_stripe_apple_pay_params.line_items=e.line_items}})}};p.init(),e(document.body).on("updated_cart_totals",function(){p.init()}),e(document.body).on("updated_checkout",function(){p.init()})});