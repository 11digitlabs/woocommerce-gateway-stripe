jQuery(function(e){"use strict";e("form.checkout, form#order_review").on("change",'input[name="wc-stripe-payment-token"]',function(){"new"===e('.stripe-legacy-payment-fields input[name="wc-stripe-payment-token"]:checked').val()?e(".stripe-legacy-payment-fields #stripe-payment-data").slideDown(200):e(".stripe-legacy-payment-fields #stripe-payment-data").slideUp(200)});var r,t=Stripe(wc_stripe_params.key),o=t.elements(),n={init:function(){e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_stripe",this.onSubmit),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form#add_payment_method").on("submit",this.onSubmit),e(document).on("stripeError",this.onError).on("checkout_error",this.clearSource);var t={base:{iconColor:"#666EE8",color:"#31325F",lineHeight:"50px",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}};(r=o.create("card",{style:t,hidePostalCode:!0})).addEventListener("change",function(r){n.onCCFormChange(),r.error&&e(document.body).trigger("stripeError",r)}),wc_stripe_params.is_checkout?e(document.body).on("updated_checkout",function(){r&&r.unmount("#stripe-card-element"),r.mount("#stripe-card-element")}):r.mount("#stripe-card-element")},isStripeChosen:function(){return e("#payment_method_stripe").is(":checked")&&(!e('input[name="wc-stripe-payment-token"]:checked').length||"new"===e('input[name="wc-stripe-payment-token"]:checked').val())},isStripeCardChosen:function(){return e("#payment_method_stripe").is(":checked")},hasSource:function(){return 0<e("input.stripe-source").length},block:function(){n.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){n.form.unblock()},onError:function(r,t){var o=t.error.message;"invalid_request_error"!==t.error.type&&"api_connection_error"!==t.error.type&&"api_error"!==t.error.type&&"authentication_error"!==t.error.type&&"rate_limit_error"!==t.error.type||(o=wc_stripe_params.invalid_request_error),"card_error"===t.error.type&&wc_stripe_params.hasOwnProperty(t.error.code)&&(o=wc_stripe_params[t.error.code]),e(".wc-stripe-error, .stripe-source").remove(),e("#stripe-card-errors").html('<ul class="woocommerce_error woocommerce-error wc-stripe-error"><li>'+o+"</li></ul>"),n.unblock()},onSubmit:function(o){if(n.isStripeChosen()&&!n.hasSource()){o.preventDefault(),n.block();var i=e("#billing_first_name").length?e("#billing_first_name").val():wc_stripe_params.billing_first_name,a=e("#billing_last_name").length?e("#billing_last_name").val():wc_stripe_params.billing_last_name,s={owner:{name:"",address:{},email:"",phone:""}};return s.owner.name=i,i&&a&&(s.owner.name=i+" "+a),s.owner.email=e("#billing_email").val(),s.owner.phone=e("#billing_phone").val(),e("#billing_address_1").length>0?(s.owner.address.line1=e("#billing_address_1").val(),s.owner.address.line2=e("#billing_address_2").val(),s.owner.address.state=e("#billing_state").val(),s.owner.address.city=e("#billing_city").val(),s.owner.address.postal_code=e("#billing_postcode").val(),s.owner.address.country=e("#billing_country").val()):wc_stripe_params.billing_address_1&&(s.owner.address.line1=wc_stripe_params.billing_address_1,s.owner.address.line2=wc_stripe_params.billing_address_2,s.owner.address.state=wc_stripe_params.billing_state,s.owner.address.city=wc_stripe_params.billing_city,s.owner.address.postal_code=wc_stripe_params.billing_postcode,s.owner.address.country=wc_stripe_params.billing_country),0<e("#stripe-payment-data").data("amount")&&(s.amount=e("#stripe-payment-data").data("amount")),e("#stripe-payment-data").data("currency").length&&(s.currency=e("#stripe-payment-data").data("currency")),n.isStripeCardChosen&&(s.type="card"),t.createSource(r,s).then(function(r){r.error?e(document.body).trigger("stripeError",r):"no"===wc_stripe_params.allow_prepaid_card&&"prepaid"===r.source.card.funding?(r.error={message:wc_stripe_params.no_prepaid_card_msg},e(document.body).trigger("stripeError",r)):n.onStripeResponse(r.source)}),!1}},isThreeDSecure:function(e){},onCCFormChange:function(){e(".wc-stripe-error, .stripe-source").remove()},onStripeResponse:function(e){n.clearSource(),n.form.append("<input type='hidden' class='stripe-source' name='stripe_source' value='"+e.id+"'/>"),n.form.submit()},clearSource:function(){e(".stripe-source").remove()}};n.init()});