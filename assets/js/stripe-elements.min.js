jQuery(function(e){"use strict";e("form.checkout, form#order_review").on("change",'input[name="wc-stripe-payment-token"]',function(){"new"===e('.stripe-legacy-payment-fields input[name="wc-stripe-payment-token"]:checked').val()?e(".stripe-legacy-payment-fields #stripe-payment-data").slideDown(200):e(".stripe-legacy-payment-fields #stripe-payment-data").slideUp(200)});var r,t=Stripe(wc_stripe_params.key),o=t.elements(),n={init:function(){e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_stripe",this.onSubmit),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form#add_payment_method").on("submit",this.onSubmit),e(document).on("stripeError",this.onError).on("checkout_error",this.clearToken);var t={base:{iconColor:"#666EE8",color:"#31325F",lineHeight:"50px",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}};(r=o.create("card",{style:t,hidePostalCode:!0})).addEventListener("change",function(r){n.onCCFormChange(),r.error&&e(document.body).trigger("stripeError",r)}),e(document.body).on("updated_checkout",function(){r&&r.unmount("#stripe-card-element"),r.mount("#stripe-card-element")})},isStripeChosen:function(){return e("#payment_method_stripe").is(":checked")&&(!e('input[name="wc-stripe-payment-token"]:checked').length||"new"===e('input[name="wc-stripe-payment-token"]:checked').val())},hasToken:function(){return 0<e("input.stripe_token").length},block:function(){n.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){n.form.unblock()},onError:function(r,t){var o=t.error.message;"invalid_request_error"!==t.error.type&&"api_connection_error"!==t.error.type&&"api_error"!==t.error.type&&"authentication_error"!==t.error.type&&"rate_limit_error"!==t.error.type||(o=wc_stripe_params.invalid_request_error),"card_error"===t.error.type&&wc_stripe_params.hasOwnProperty(t.error.code)&&(o=wc_stripe_params[t.error.code]),e(".wc-stripe-error, .stripe_token").remove(),e("#stripe-card-errors").html('<ul class="woocommerce_error woocommerce-error wc-stripe-error"><li>'+o+"</li></ul>"),n.unblock()},onSubmit:function(o){if(n.isStripeChosen()&&!n.hasToken()){o.preventDefault(),n.block();var i=e("#billing_first_name").length?e("#billing_first_name").val():wc_stripe_params.billing_first_name,s=e("#billing_last_name").length?e("#billing_last_name").val():wc_stripe_params.billing_last_name;return i&&s&&(r.name=i+" "+s),e("#billing_address_1").length>0?(r.address_line1=e("#billing_address_1").val(),r.address_line2=e("#billing_address_2").val(),r.address_state=e("#billing_state").val(),r.address_city=e("#billing_city").val(),r.address_zip=e("#billing_postcode").val(),r.address_country=e("#billing_country").val()):wc_stripe_params.billing_address_1&&(r.address_line1=wc_stripe_params.billing_address_1,r.address_line2=wc_stripe_params.billing_address_2,r.address_state=wc_stripe_params.billing_state,r.address_city=wc_stripe_params.billing_city,r.address_zip=wc_stripe_params.billing_postcode,r.address_country=wc_stripe_params.billing_country),t.createToken(r).then(function(r){r.error?e(document.body).trigger("stripeError",r):"no"===wc_stripe_params.allow_prepaid_card&&"prepaid"===r.token.card.funding?(r.error={message:wc_stripe_params.no_prepaid_card_msg},e(document.body).trigger("stripeError",r)):n.onStripeResponse(r.token)}),!1}},onCCFormChange:function(){e(".wc-stripe-error, .stripe_token").remove()},onStripeResponse:function(e){n.clearToken(),n.form.append("<input type='hidden' class='stripe_token' name='stripe_token' value='"+e.id+"'/>"),n.form.submit()},clearToken:function(){e(".stripe_token").remove()}};n.init()});