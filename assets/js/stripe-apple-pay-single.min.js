Stripe.setPublishableKey(wc_stripe_apple_pay_single_params.key),jQuery(function(e){"use strict";var a={getAjaxURL:function(e){return wc_stripe_apple_pay_single_params.ajaxurl.toString().replace("%%endpoint%%","wc_stripe_"+e)},init:function(){Stripe.applePay.checkAvailability(function(a){a&&e(".apple-pay-button").show()}),e(document.body).on("click",".apple-pay-button",function(t){t.preventDefault();var p=e(".single_add_to_cart_button");if(p.is(".disabled"))p.is(".wc-variation-is-unavailable")?window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text):p.is(".wc-variation-selection-needed")&&window.alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text);else{var n={countryCode:wc_stripe_apple_pay_single_params.country_code,currencyCode:wc_stripe_apple_pay_single_params.currency_code,total:{label:wc_stripe_apple_pay_single_params.label,amount:"1.00",type:"pending"},lineItems:[{label:wc_stripe_apple_pay_single_params.i18n.sub_total,amount:"1.00",type:"pending"}],requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:"yes"===wc_stripe_apple_pay_single_params.needs_shipping?["postalAddress","phone","email","name"]:["phone","email","name"]},i=Stripe.applePay.buildSession(n,function(t,p){var n={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_nonce,result:t};e.ajax({type:"POST",data:n,url:a.getAjaxURL("apple_pay"),success:function(a){"true"===a.success&&(p(ApplePaySession.STATUS_SUCCESS),window.location.href=a.redirect),"false"===a.success&&(p(ApplePaySession.STATUS_FAILURE),e(".apple-pay-button").before('<p class="woocommerce-error wc-stripe-apple-pay-error">'+a.msg+"</p>"),e(document.body).animate({scrollTop:e(".wc-stripe-apple-pay-error").offset().top},500))}})},function(t){var p={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_nonce,errors:t.message};e.ajax({type:"POST",data:p,url:a.getAjaxURL("log_apple_pay_errors")})});"yes"===wc_stripe_apple_pay_single_params.needs_shipping&&(i.onshippingcontactselected=function(t){e.when(a.generate_cart()).then(function(){var p={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_get_shipping_methods_nonce,address:t.shippingContact};e.ajax({type:"POST",data:p,url:a.getAjaxURL("apple_pay_get_shipping_methods"),success:function(e){var a={label:wc_stripe_apple_pay_single_params.label,amount:e.total};e.total<=0&&(a.amount=1,a.type="pending"),"true"===e.success&&i.completeShippingContactSelection(ApplePaySession.STATUS_SUCCESS,e.shipping_methods,a,e.line_items),"false"===e.success&&i.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,e.shipping_methods,a,e.line_items)}})})},i.onshippingmethodselected=function(t){var p={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_update_shipping_method_nonce,selected_shipping_method:t.shippingMethod};e.ajax({type:"POST",data:p,url:a.getAjaxURL("apple_pay_update_shipping_method"),success:function(e){var a={label:wc_stripe_apple_pay_single_params.label,amount:parseFloat(e.total).toFixed(2)};"true"===e.success&&i.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS,a,e.line_items),"false"===e.success&&i.completeShippingMethodSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,a,e.line_items)}})}),i.onpaymentmethodselected=function(t){e.when(a.generate_cart()).then(function(){var e={label:wc_stripe_apple_pay_single_params.label,amount:wc_stripe_apple_pay_single_params.total},a=wc_stripe_apple_pay_single_params.line_items;i.completePaymentMethodSelection(e,a)})},i.oncancel=function(e){a.clear_cart()},i.begin()}})},get_attributes:function(){var a={},t=0,p=0;return e(".variations_form").find(".variations select").each(function(){var n=e(this).data("attribute_name")||e(this).attr("name"),i=e(this).val()||"";i.length>0&&p++,t++,a[n]=i}),{count:t,chosenCount:p,data:a}},generate_cart:function(){var t={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_cart_nonce,qty:e(".quantity .qty").val(),attributes:e(".variations_form").length?a.get_attributes().data:[]};return e.ajax({type:"POST",data:t,url:a.getAjaxURL("generate_apple_pay_single"),success:function(e){wc_stripe_apple_pay_single_params.total=e.total,wc_stripe_apple_pay_single_params.line_items=e.line_items}})},clear_cart:function(){var t={nonce:wc_stripe_apple_pay_single_params.stripe_apple_pay_cart_nonce};return e.ajax({type:"POST",data:t,url:a.getAjaxURL("apple_pay_clear_cart"),success:function(e){}})}};a.init()});