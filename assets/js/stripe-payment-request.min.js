jQuery(function(t){"use strict";var e=Stripe(wc_stripe_payment_request_params.stripe.key),a={getAjaxURL:function(t){return wc_stripe_payment_request_params.ajax_url.toString().replace("%%endpoint%%","wc_stripe_"+t)},getCartDetails:function(e){var n={security:wc_stripe_payment_request_params.nonce.payment};t.ajax({type:"POST",data:n,url:a.getAjaxURL("get_cart_details"),success:function(t){e.update({total:t.order_data.total})}})},getAttributes:function(){var e={},a=0,n=0;return t(".variations_form").find(".variations select").each(function(){var i=t(this).data("attribute_name")||t(this).attr("name"),s=t(this).val()||"";s.length>0&&n++,a++,e[i]=s}),{count:a,chosenCount:n,data:e}},processSource:function(e,n){var i=a.getOrderData(e,n);return t.ajax({type:"POST",data:i,dataType:"json",url:a.getAjaxURL("create_order")})},getOrderData:function(t,e){var a=t.source,n=a.owner.address,i=t.shippingAddress,s={_wpnonce:wc_stripe_payment_request_params.nonce.checkout,billing_first_name:a.owner.name.split(" ").slice(0,1).join(" "),billing_last_name:a.owner.name.split(" ").slice(1).join(" "),billing_company:"",billing_email:a.owner.email,billing_phone:a.owner.phone,billing_country:n.country,billing_address_1:n.line1,billing_address_2:n.line2,billing_city:n.city,billing_state:n.state,billing_postcode:n.postal_code,shipping_first_name:"",shipping_last_name:"",shipping_company:"",shipping_country:"",shipping_address_1:"",shipping_address_2:"",shipping_city:"",shipping_state:"",shipping_postcode:"",shipping_method:[null===t.shippingOption?null:t.shippingOption.id],order_comments:"",payment_method:"stripe",ship_to_different_address:1,terms:1,stripe_source:JSON.stringify(a),payment_request_type:e};return i&&(s.shipping_first_name=i.recipient.split(" ").slice(0,1).join(" "),s.shipping_last_name=i.recipient.split(" ").slice(1).join(" "),s.shipping_company=i.organization,s.shipping_country=i.country,s.shipping_address_1=void 0===i.addressLine[0]?"":i.addressLine[0],s.shipping_address_2=void 0===i.addressLine[1]?"":i.addressLine[1],s.shipping_city=i.city,s.shipping_state=i.region,s.shipping_postcode=i.postalCode),s},getErrorMessageHTML:function(e){return t('<div class="woocommerce-error" />').text(e)},abortPayment:function(e,a){e.complete("fail");var n=t(".shop_table.cart").closest("form");t(".woocommerce-error").remove(),n.before(a),t("html, body").animate({scrollTop:n.prev(".woocommerce-error").offset().top},600)},completePayment:function(t,e){a.block(),t.complete("success"),window.location=e},block:function(){t.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateShippingOptions:function(e,n){var i={security:wc_stripe_payment_request_params.nonce.shipping,country:n.country,state:n.region,postcode:n.postalCode,city:n.city,address:void 0===n.addressLine[0]?"":n.addressLine[0],address_2:void 0===n.addressLine[1]?"":n.addressLine[1]};return t.ajax({type:"POST",data:i,url:a.getAjaxURL("get_shipping_options")})},updateShippingDetails:function(e,n){var i={security:wc_stripe_payment_request_params.nonce.update_shipping,shipping_method:[n.id]};return t.ajax({type:"POST",data:i,url:a.getAjaxURL("update_shipping_method")})},addToCart:function(){var e={security:wc_stripe_payment_request_params.nonce.add_to_cart,product_id:t(".single_add_to_cart_button").val(),qty:t(".quantity .qty").val(),attributes:t(".variations_form").length?a.getAttributes().data:[]};return t.ajax({type:"POST",data:e,url:a.getAjaxURL("add_to_cart")})},clearCart:function(){var e={security:wc_stripe_payment_request_params.nonce.clear_cart};return t.ajax({type:"POST",data:e,url:a.getAjaxURL("clear_cart"),success:function(t){}})},startPaymentRequest:function(n){var i={total:n.order_data.total,currency:n.order_data.currency,country:n.order_data.country_code,requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0,requestShipping:!!n.shipping_required,displayItems:n.order_data.displayItems},s=e.paymentRequest(i),r="",p=n.order_data,o=e.elements({locale:wc_stripe_payment_request_params.button.locale}).create("paymentRequestButton",{paymentRequest:s,style:{paymentRequestButton:{type:wc_stripe_payment_request_params.button.type,theme:wc_stripe_payment_request_params.button.theme,height:wc_stripe_payment_request_params.button.height+"px"}}});wc_stripe_payment_request_params.is_product_page&&o.on("click",function(e){e.preventDefault(),t.when(a.addToCart()).then(function(e){t.when(s.update({total:e.total,displayItems:e.displayItems})).then(function(){s.show()})})}),s.canMakePayment().then(function(e){e?(r=e.applePay?"apple_pay":"payment_request_api",o.mount("#wc-stripe-payment-request-button"),t("#wc-stripe-payment-request-button-separator").show()):(t("#wc-stripe-payment-request-button").hide(),t("#wc-stripe-payment-request-button-separator").hide())}),s.on("shippingaddresschange",function(e){t.when(a.updateShippingOptions(p,e.shippingAddress)).then(function(t){e.updateWith({status:t.result,shippingOptions:t.shipping_options,total:t.total,displayItems:t.displayItems})})}),s.on("shippingoptionchange",function(e){t.when(a.updateShippingDetails(p,e.shippingOption)).then(function(t){"success"===t.result&&e.updateWith({status:"success",total:t.total,displayItems:t.displayItems}),"fail"===t.result&&e.updateWith({status:"fail"})})}),s.on("source",function(e){"no"===wc_stripe_payment_request_params.stripe.allow_prepaid_card&&"prepaid"===e.source.card.funding?a.abortPayment(e,a.getErrorMessageHTML(wc_stripe_payment_request_params.i18n.no_prepaid_card)):t.when(a.processSource(e,r)).then(function(t){"success"===t.result?a.completePayment(e,t.redirect):a.abortPayment(e,t.messages)})})},init:function(){var e={security:wc_stripe_payment_request_params.nonce.payment};t.ajax({type:"POST",data:e,url:a.getAjaxURL("get_cart_details"),success:function(t){a.startPaymentRequest(t)}})}};a.init(),t(document.body).on("updated_cart_totals",function(){a.init()}),t(document.body).on("updated_checkout",function(){a.init()})});